# ═══════════════════════════════════════════════════════════════════════════════
# NYOWORKS Framework - Agent Roles Configuration
# ═══════════════════════════════════════════════════════════════════════════════
#
# This file defines all AI agent roles with:
# - Capabilities and responsibilities
# - Bible section access
# - Context limits and phase assignments
# - MCP tool permissions
#
# Bible Structure (Updated 2026-02-04):
# - 01-vision/       Vision & Mission
# - 02-users/        User Types & Roles
# - 03-features/     Feature Specifications
# - 04-data/         Data Quality & Methodology
# - 05-tech/         Technical Architecture
#   - architecture/  System Design
#   - database/      Schema & Migrations
#   - api/           Routes & Contracts
#   - security/      Auth & RBAC
#   - devops/        CI/CD & Infrastructure
#   - apps/          Web & Mobile Specs
# - 06-ux/           User Experience
# - 07-quality/      Testing & Edge Cases
# - 09-decisions/    Authoritative Decisions
# - 90-logs/         Task & Audit Logs
# - 98-backlog/      Future Features
# - 99-tracking/     Gap & Status Tracking
#
# ═══════════════════════════════════════════════════════════════════════════════

roles:
  # ═══════════════════════════════════════════════════════════════════════════
  # Project Lead - Orchestration & Management
  # ═══════════════════════════════════════════════════════════════════════════
  - id: lead
    name: Project Lead
    description: Orchestrates workflow, manages tasks, ensures quality across all phases
    command: /lead
    bible_sections:
      auto_load:
        - 09-decisions/01-decisions.md
        - 01-vision/
        - 99-tracking/GAPS.md
        - 99-tracking/IMPLEMENTATION_STATUS.md
      on_demand:
        - "*"
    max_context_tokens: 32000
    capabilities:
      - Create and assign tasks
      - Advance workflow phases
      - Force unlock any task
      - Record decisions
      - Review all deliverables
      - Approve phase transitions
      - Rollback phases when needed
    mcp_tools:
      allowed:
        - init_project
        - get_status
        - set_phase
        - create_task
        - update_task
        - claim_task
        - release_task
        - force_release_task
        - get_all_locks
        - record_decision
        - list_features
        - enable_feature
        - disable_feature
        - log_activity
        - get_activity_log
        - validate_phase_transition
        - add_task_progress
        - add_subtask
        - complete_subtask
        - get_task_progress
        - validate_work_authorization
        - check_orphan_code
        - heartbeat
        - get_pending_handoffs
        - acknowledge_handoff
        - create_handoff
        - get_sub_phase
        - get_spec
        - create_spec
        - set_sub_phases
        - advance_sub_phase
        - approve_spec
        - require_spec
        - approve_check
        - get_visual_guidance
        - get_shared_architecture
      restricted: []
    active_in_all_phases: true
    can_override_locks: true
    language:
      chat: tr
      code: en

  # ═══════════════════════════════════════════════════════════════════════════
  # System Architect - Design & Contracts
  # ═══════════════════════════════════════════════════════════════════════════
  - id: architect
    name: System Architect
    description: Designs systems, schemas, and API contracts
    command: /architect
    bible_sections:
      auto_load:
        - 09-decisions/01-decisions.md
        - 05-tech/database/01-schema.md
        - 05-tech/architecture/01-overview.md
        - 05-tech/api/01-routes.md
      on_demand:
        - 02-users/
        - 07-quality/
    max_context_tokens: 24000
    capabilities:
      - Design database schemas
      - Define API contracts
      - Make technical decisions
      - Review architecture
      - Document security model
      - Define data relationships
    mcp_tools:
      allowed:
        - get_status
        - create_task
        - claim_task
        - release_task
        - record_decision
        - get_bible_section
        - log_activity
        - add_task_progress
        - add_subtask
        - complete_subtask
        - get_task_progress
        - validate_work_authorization
        - check_orphan_code
        - heartbeat
        - get_pending_handoffs
        - acknowledge_handoff
        - create_handoff
        - get_sub_phase
        - get_spec
        - create_spec
        - approve_spec
        - get_shared_architecture
      restricted:
        - set_phase
        - force_release_task
    active_phases:
      - ARCHITECTURE
      - PLANNING
    language:
      chat: tr
      code: en

  # ═══════════════════════════════════════════════════════════════════════════
  # UI/UX Designer - Interface & Experience
  # ═══════════════════════════════════════════════════════════════════════════
  - id: designer
    name: UI/UX Designer
    description: Designs user interfaces, components, and experiences
    command: /designer
    bible_sections:
      auto_load:
        - 06-ux/01-user-flows.md
        - 06-ux/02-ui-specifications.md
        - 06-ux/06-design-themes.md
      on_demand:
        - 06-ux/
        - 01-vision/
    max_context_tokens: 16000
    capabilities:
      - Design UI components (shadcn/ui)
      - Create user flow diagrams
      - Define design system tokens
      - Ensure WCAG 2.1 AA compliance
      - Create responsive layouts
      - Design dark/light themes
    mcp_tools:
      allowed:
        - get_status
        - create_task
        - claim_task
        - release_task
        - get_bible_section
        - log_activity
        - add_task_progress
        - add_subtask
        - complete_subtask
        - get_task_progress
        - validate_work_authorization
        - check_orphan_code
        - heartbeat
        - get_pending_handoffs
        - acknowledge_handoff
        - create_handoff
        - get_sub_phase
        - get_spec
        - create_spec
        - get_visual_guidance
      restricted:
        - set_phase
    active_phases:
      - DESIGN
      - FRONTEND
    tech_stack:
      components: shadcn/ui + Radix
      styling: Tailwind CSS 4
      animations: Framer Motion
      icons: Lucide React
    language:
      chat: tr
      code: en

  # ═══════════════════════════════════════════════════════════════════════════
  # Backend Developer - API & Business Logic
  # ═══════════════════════════════════════════════════════════════════════════
  - id: backend
    name: Backend Developer
    description: Implements APIs, business logic, and database operations
    command: /backend
    bible_sections:
      auto_load:
        - 05-tech/database/01-schema.md
        - 05-tech/api/01-routes.md
        - 05-tech/api/03-contract.md
      on_demand:
        - 03-features/
        - 05-tech/
    max_context_tokens: 16000
    capabilities:
      - Implement API endpoints (Hono)
      - Write business logic
      - Create unit tests (Vitest)
      - Handle database operations (Drizzle)
      - Implement authentication
      - Write input validation (Zod)
    mcp_tools:
      allowed:
        - get_status
        - create_task
        - claim_task
        - release_task
        - get_bible_section
        - list_features
        - log_activity
        - add_task_progress
        - add_subtask
        - complete_subtask
        - get_task_progress
        - validate_work_authorization
        - check_orphan_code
        - heartbeat
        - get_pending_handoffs
        - acknowledge_handoff
        - create_handoff
        - get_sub_phase
        - get_spec
        - create_spec
      restricted:
        - set_phase
        - enable_feature
    active_phases:
      - BACKEND
      - QA
    tech_stack:
      framework: Hono
      database: Drizzle ORM + PostgreSQL
      validation: Zod
      testing: Vitest
      auth: JWT (jose) + Argon2id
    language:
      chat: tr
      code: en

  # ═══════════════════════════════════════════════════════════════════════════
  # Frontend Developer - UI Implementation
  # ═══════════════════════════════════════════════════════════════════════════
  - id: frontend
    name: Frontend Developer
    description: Builds user interfaces and client-side interactions
    command: /frontend
    bible_sections:
      auto_load:
        - 06-ux/02-ui-specifications.md
        - 06-ux/06-design-themes.md
        - 05-tech/apps/web.md
      on_demand:
        - 06-ux/
        - 03-features/
    max_context_tokens: 16000
    capabilities:
      - Create React components
      - Implement Server Actions
      - Handle i18n (next-intl)
      - Implement theming
      - Build responsive layouts
      - Integrate with API
    mcp_tools:
      allowed:
        - get_status
        - create_task
        - claim_task
        - release_task
        - get_bible_section
        - list_features
        - log_activity
        - add_task_progress
        - add_subtask
        - complete_subtask
        - get_task_progress
        - validate_work_authorization
        - check_orphan_code
        - heartbeat
        - get_pending_handoffs
        - acknowledge_handoff
        - create_handoff
        - get_sub_phase
        - get_spec
        - create_spec
        - get_visual_guidance
      restricted:
        - set_phase
    active_phases:
      - FRONTEND
      - QA
    tech_stack:
      framework: Next.js 16 (App Router)
      react: 19.x
      styling: Tailwind CSS 4
      components: shadcn/ui
      state: TanStack Query v5
      forms: React Hook Form + Zod
      i18n: next-intl
    language:
      chat: tr
      code: en

  # ═══════════════════════════════════════════════════════════════════════════
  # Database Engineer - Data Architecture
  # ═══════════════════════════════════════════════════════════════════════════
  - id: data
    name: Database Engineer
    description: Designs and optimizes data models and queries
    command: /data
    bible_sections:
      auto_load:
        - 05-tech/database/01-schema.md
        - 05-tech/database/04-relationships.md
      on_demand:
        - 04-data/
        - 05-tech/database/
    max_context_tokens: 8000
    capabilities:
      - Design Drizzle schemas
      - Create migrations
      - Write RLS policies
      - Optimize queries
      - Design indexes
      - Handle data relationships
    mcp_tools:
      allowed:
        - get_status
        - create_task
        - claim_task
        - release_task
        - get_bible_section
        - log_activity
        - add_task_progress
        - add_subtask
        - complete_subtask
        - get_task_progress
        - validate_work_authorization
        - check_orphan_code
        - heartbeat
        - get_pending_handoffs
        - acknowledge_handoff
        - create_handoff
        - get_sub_phase
        - get_spec
        - create_spec
      restricted:
        - set_phase
    active_phases:
      - ARCHITECTURE
      - BACKEND
    tech_stack:
      orm: Drizzle ORM
      database: PostgreSQL 16
      driver: postgres.js
      migrations: drizzle-kit
    language:
      chat: tr
      code: en

  # ═══════════════════════════════════════════════════════════════════════════
  # QA Engineer - Quality Assurance
  # ═══════════════════════════════════════════════════════════════════════════
  - id: qa
    name: QA Engineer
    description: Ensures quality through comprehensive testing
    command: /qa
    bible_sections:
      auto_load:
        - 07-quality/04-test-plan.md
        - 99-tracking/GAPS.md
        - 99-tracking/TEST_MASTER_PLAN.md
      on_demand:
        - 99-tracking/
        - 07-quality/
    max_context_tokens: 12000
    capabilities:
      - Write test plans
      - Create E2E tests (Playwright)
      - Create integration tests
      - Perform security audits
      - Track bugs
      - Performance testing
    mcp_tools:
      allowed:
        - get_status
        - create_task
        - claim_task
        - release_task
        - get_bible_section
        - log_activity
        - add_task_progress
        - add_subtask
        - complete_subtask
        - get_task_progress
        - validate_work_authorization
        - check_orphan_code
        - heartbeat
        - get_pending_handoffs
        - acknowledge_handoff
        - create_handoff
        - get_sub_phase
        - get_spec
        - create_spec
      restricted:
        - set_phase
    active_phases:
      - QA
    tech_stack:
      unit: Vitest
      e2e: Playwright
      api: Vitest + supertest
      coverage: c8
    language:
      chat: tr
      code: en

  # ═══════════════════════════════════════════════════════════════════════════
  # DevOps Engineer - Infrastructure & Deployment
  # ═══════════════════════════════════════════════════════════════════════════
  - id: devops
    name: DevOps Engineer
    description: Handles deployment, infrastructure, and CI/CD
    command: /devops
    bible_sections:
      auto_load:
        - 05-tech/devops/02-devops.md
        - 05-tech/devops/03-infrastructure.md
      on_demand:
        - 05-tech/devops/
        - 05-tech/security/
    max_context_tokens: 8000
    capabilities:
      - Configure Docker (distroless)
      - Set up CI/CD (GitHub Actions)
      - Manage AWS resources (ECS, RDS, S3)
      - Configure monitoring (Grafana)
      - Infrastructure as Code (Pulumi)
      - Security hardening
    mcp_tools:
      allowed:
        - get_status
        - create_task
        - claim_task
        - release_task
        - get_bible_section
        - log_activity
        - add_task_progress
        - add_subtask
        - complete_subtask
        - get_task_progress
        - validate_work_authorization
        - check_orphan_code
        - heartbeat
        - get_pending_handoffs
        - acknowledge_handoff
        - create_handoff
        - get_sub_phase
        - get_spec
        - create_spec
      restricted:
        - set_phase
    active_phases:
      - DEPLOYMENT
      - QA
    tech_stack:
      containers: Docker + distroless
      orchestration: AWS ECS Fargate
      iac: Pulumi (TypeScript)
      ci_cd: GitHub Actions
      monitoring: Grafana + Prometheus
      logging: Loki
      tracing: Tempo
    language:
      chat: tr
      code: en

# ─────────────────────────────────────────────────────────────────────────────
# Role Collaboration Matrix
# ─────────────────────────────────────────────────────────────────────────────

collaboration:
  DISCOVERY:
    primary: lead
    support: []
    handoff_to: ARCHITECTURE

  ARCHITECTURE:
    primary: architect
    support: [lead, data]
    handoff_to: DESIGN

  DESIGN:
    primary: designer
    support: [lead, frontend]
    handoff_to: PLANNING

  PLANNING:
    primary: lead
    support: [architect]
    handoff_to: BACKEND

  BACKEND:
    primary: backend
    support: [data]
    handoff_to: FRONTEND

  FRONTEND:
    primary: frontend
    support: [designer]
    handoff_to: QA

  QA:
    primary: qa
    support: [backend, frontend, devops]
    handoff_to: DEPLOYMENT

  DEPLOYMENT:
    primary: devops
    support: [lead]
    handoff_to: null

# ─────────────────────────────────────────────────────────────────────────────
# Task Assignment Rules
# ─────────────────────────────────────────────────────────────────────────────

assignment_rules:
  - pattern: "schema:*"
    roles: [data, architect]
    priority: 1

  - pattern: "api:*"
    roles: [backend]
    priority: 1

  - pattern: "ui:*"
    roles: [frontend, designer]
    priority: 1

  - pattern: "design:*"
    roles: [designer]
    priority: 1

  - pattern: "test:*"
    roles: [qa]
    priority: 1

  - pattern: "test:integration:*"
    roles: [qa, backend]
    priority: 2

  - pattern: "test:e2e:*"
    roles: [qa]
    priority: 1

  - pattern: "deploy:*"
    roles: [devops]
    priority: 1

  - pattern: "docker:*"
    roles: [devops]
    priority: 1

  - pattern: "cicd:*"
    roles: [devops]
    priority: 1

  - pattern: "infra:*"
    roles: [devops]
    priority: 1

  - pattern: "docs:*"
    roles: [lead, architect]
    priority: 2

  - pattern: "bug:*"
    roles: [backend, frontend]
    priority: 1

  - pattern: "security:*"
    roles: [qa, backend]
    priority: 1

  - pattern: "*"
    roles: [lead]
    priority: 99

# ─────────────────────────────────────────────────────────────────────────────
# Conflict Resolution Rules
# ─────────────────────────────────────────────────────────────────────────────

conflict_resolution:
  strategy: first_claim_wins
  lock_timeout: 30
  heartbeat_interval: 5
  force_release_roles:
    - lead
  escalation:
    timeout_minutes: 60
    notify: lead

# ─────────────────────────────────────────────────────────────────────────────
# Role Communication Protocol
# ─────────────────────────────────────────────────────────────────────────────

communication:
  logging:
    enabled: true
    log_file: .nyoworks/activity.log

  handoff:
    notify_on_complete: true
    include_summary: true
    require_ack: false

  blocking:
    notify_lead: true
    log_to_gaps: true

# ─────────────────────────────────────────────────────────────────────────────
# Role Permissions Matrix
# ─────────────────────────────────────────────────────────────────────────────

permissions:
  file_access:
    lead:
      read: ["*"]
      write: ["docs/bible/**", ".nyoworks/**", "nyoworks.config.yaml"]

    architect:
      read: ["*"]
      write: ["docs/bible/02-*/**", "docs/bible/04-*/**", "docs/bible/05-*/**", "packages/database/src/db/schema/**"]

    designer:
      read: ["*"]
      write: ["docs/bible/06-*/**", "packages/ui/**", "apps/web/src/styles/**"]

    backend:
      read: ["*"]
      write: ["apps/api/**", "packages/validators/**", "packages/shared/**"]

    frontend:
      read: ["*"]
      write: ["apps/web/**", "apps/mobile/**", "packages/ui/**"]

    data:
      read: ["*"]
      write: ["packages/database/**"]

    qa:
      read: ["*"]
      write: ["tests/**", "docs/bible/99-*/**", "docs/bible/07-*/**"]

    devops:
      read: ["*"]
      write: ["docker/**", ".github/**", "infra/**", "scripts/**"]

  phase_transition:
    can_advance: [lead]
    can_rollback: [lead]
    can_approve: [lead]
